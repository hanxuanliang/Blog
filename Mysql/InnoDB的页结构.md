# InnoDB数据页结构

## 页是什么？

页是**InnoDB**管理储蓄空间的基本单位，一个页的大小一般是**16KB**。**InnoDB**为了不同的目的从而设计了很多不同类型的**页**，比如存放表空间头部信息的页，存放**Insert Buffer**信息的页，等等。前面只是说有这些页，我们现在聚焦的是那些存放我们表记录的那些类型的页，官方称这种存放记录的页为**索引（Index）页**，鉴于我们还没有了解过**index**是什么东西，所以目前还是叫这种存放记录的页为**数据页**。

## 数据页的结构快速浏览

直接上一张表格：

| 名称                     | 中文名           | 占用空间大小   | 简单描述           |
|:----------------------:|:-------------:|:--------:|:--------------:|
| **File Header**        | 文件头部          | **38**字节 | 页的一些通用信息       |
| **Page Header**        | 页面头部          | **56**字节 | 数据页专有的一些信息     |
| **Infimum + Supremum** | **最小记录和最大记录** | **26**字节 | 两个虚拟的行记录       |
| **User Records**       | **用户记录**      | 不确定      | **实际存储的行记录内容** |
| **Free Space**         | 空闲空间          | 不确定      | 页中尚未使用的空间      |
| **Page Directory**     | 页面目录          | 不确定      | 页中的某些记录的相对位置   |
| **File Trailer**       | 文件尾部          | **8**字节  | 校验页是否完整        |

> 但是我不准备按照表格里面的各个部分的顺序来介绍他们，因为很多我自己目前不了解的概念，怕打击我自己

## 用户记录发生了什么？

在页的7个组成部分中，我们自己存储的记录会按照我们指定的`行格式`存储到`User Records`部分。但是在一开始生成页的时候，其实是没有`User Records`部分，而每当我们插入一条数据记录，都会从`Free Space`里面抽一部分划分到`User Records`部分，当`Free Space`部分的空间全部被`User Records`部分替代掉之后，也就意味着这个页使用完了，如果还有新的记录插入的话，就需要去申请新的页了，以下是插入过程的图示：

![\Pic\新建一条数据](..\Pic\新建一条数据.jpg)

为了更好地管理在`User Records`中的这些记录，`InnoDB`费了一番力气！难道不就是把记录按照指定的行格式一条一条摆在`User Records`部分么？其实这话还得从记录行格式的`记录头信息`中说起。

### 记录头信息的秘密

```sql
create table page_demo(
    c1 INT,
    c2 INT,
    c3 VARCHAR(10000),
    PRIMARY KEY (c1)
) CHARSET=ascii ROW_FORMAT=Compact;
```
